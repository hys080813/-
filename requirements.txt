import streamlit as st
import math

def calculate_geometric_ratio(first_term, nth_term, n):
    """
    ë“±ë¹„ìˆ˜ì—´ì˜ ì²«ì§¸ í•­, në²ˆì§¸ í•­, ê·¸ë¦¬ê³  nì„ ì…ë ¥ë°›ì•„ ê³µë¹„ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.

    Args:
        first_term (float): ë“±ë¹„ìˆ˜ì—´ì˜ ì²«ì§¸ í•­ (a1).
        nth_term (float): ë“±ë¹„ìˆ˜ì—´ì˜ në²ˆì§¸ í•­ (an).
        n (int): në²ˆì§¸ í•­ì˜ ìœ„ì¹˜ (nì€ 1ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤).

    Returns:
        float: ë“±ë¹„ìˆ˜ì—´ì˜ ê³µë¹„ (r).
        str: ì˜¤ë¥˜ ë©”ì‹œì§€ (ìœ íš¨í•˜ì§€ ì•Šì€ ì…ë ¥ì˜ ê²½ìš°).
    """
    if n <= 1:
        return "nì€ 1ë³´ë‹¤ í° ì •ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤. (ì²«ì§¸ í•­ê³¼ në²ˆì§¸ í•­ì´ ê°™ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.)"
    if first_term == 0:
        return "ì²«ì§¸ í•­ì€ 0ì´ ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
    
    # ìŒìˆ˜ì˜ ì§ìˆ˜ ì œê³±ê·¼ ì²˜ë¦¬ (ë³µì†Œìˆ˜ ê³µë¹„ê°€ ì•„ë‹Œ ì‹¤ìˆ˜ ê³µë¹„ë§Œ ë‹¤ë£¨ëŠ” ê²½ìš°)
    if (nth_term / first_term) < 0 and (n - 1) % 2 == 0:
        return "ìŒìˆ˜ì˜ ì§ìˆ˜ ì œê³±ê·¼ì€ ì‹¤ìˆ˜ ê³µë¹„ë¥¼ ê³„ì‚°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ê³µë¹„ê°€ ë³µì†Œìˆ˜ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)"

    try:
        # 0ìœ¼ë¡œ ë‚˜ëˆ„ëŠ” ê²½ìš°ë¥¼ ë°©ì§€ (first_termì´ 0ì¸ ê²½ìš°ëŠ” ìœ„ì—ì„œ ì²˜ë¦¬í•¨)
        # 0ì˜ ê±°ë“­ì œê³±ì´ 0ì¸ ê²½ìš°ë¥¼ ê³ ë ¤í•˜ì—¬ ì˜ˆì™¸ ì²˜ë¦¬
        if nth_term == 0 and first_term != 0:
            return 0.0 # anì´ 0ì´ë©´ ê³µë¹„ê°€ 0ì¼ ìˆ˜ ìˆìŒ (ë‹¨, a1ì´ 0ì´ ì•„ë‹ ë•Œ)
        elif nth_term != 0 and first_term == 0: # ì´ë¯¸ ìœ„ì—ì„œ ì²˜ë¦¬ë˜ì§€ë§Œ í˜¹ì‹œ ëª¨ë¥¼ ìƒí™© ëŒ€ë¹„
            return "ì²«ì§¸ í•­ì€ 0ì´ ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."

        ratio = (nth_term / first_term)**(1 / (n - 1))
        
        # ë¶€ë™ì†Œìˆ˜ì  ì˜¤ì°¨ë¡œ ì¸í•œ ë¯¸ì„¸í•œ ìŒìˆ˜ ê°’ ì²˜ë¦¬ (ì˜ˆ: -0.0000000000000001 -> 0)
        if abs(ratio) < 1e-9: # ì•„ì£¼ ì‘ì€ ê°’ì€ 0ìœ¼ë¡œ ê°„ì£¼
            ratio = 0.0
            
        return ratio
    except ZeroDivisionError:
        return "ê³„ì‚° ì¤‘ 0ìœ¼ë¡œ ë‚˜ëˆ„ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (ì¼ë°˜ì ìœ¼ë¡œ ì²«ì§¸ í•­ì´ 0ì¼ ë•Œ ë°œìƒ)"
    except OverflowError:
        return "ê³„ì‚° ê²°ê³¼ê°€ ë„ˆë¬´ ì»¤ì„œ í‘œí˜„í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
    except Exception as e:
        return f"ê³µë¹„ ê³„ì‚° ì¤‘ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}"

st.set_page_config(page_title="ë“±ë¹„ìˆ˜ì—´ ê³µë¹„ ê³„ì‚°ê¸°", layout="centered")

st.title("ğŸ”¢ ë“±ë¹„ìˆ˜ì—´ ê³µë¹„ ê³„ì‚°ê¸°")
st.markdown("ì²«ì§¸ í•­ê³¼ $n$ë²ˆì§¸ í•­ì˜ ê°’ì„ ì…ë ¥í•˜ì—¬ ë“±ë¹„(ê³µë¹„)ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.")

st.sidebar.header("ì…ë ¥ ê°’")
a1 = st.sidebar.number_input("ì²«ì§¸ í•­ ($a_1$)", value=1.0, step=0.1)
an = st.sidebar.number_input("$n$ë²ˆì§¸ í•­ ($a_n$)", value=2.0, step=0.1)
n = st.sidebar.number_input("ëª‡ ë²ˆì§¸ í•­ì…ë‹ˆê¹Œ? ($n$)", value=2, min_value=2, step=1)

if st.sidebar.button("ê³µë¹„ ê³„ì‚°í•˜ê¸°"):
    if n <= 1:
        st.error("ì˜¤ë¥˜: $n$ì€ 1ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.")
    else:
        result = calculate_geometric_ratio(a1, an, n)
        
        if isinstance(result, str):
            st.error(f"ì˜¤ë¥˜: {result}")
        else:
            st.success(f"ê³„ì‚°ëœ ê³µë¹„ ($r$)ëŠ” **{result:.6f}** ì…ë‹ˆë‹¤.")
            
            st.subheader("ê³„ì‚° í™•ì¸")
            st.markdown(f"ì²«ì§¸ í•­ $a_1 = {a1}$")
            st.markdown(f"$n = {n}$")
            st.markdown(f"ê³µë¹„ $r = {result:.6f}$")
            
            # ê³„ì‚°ëœ ê³µë¹„ë¡œ në²ˆì§¸ í•­ ë‹¤ì‹œ ê³„ì‚°í•˜ì—¬ ë¹„êµ
            calculated_an = a1 * (result**(n-1))
            st.markdown(f"ê³„ì‚°ëœ ê³µë¹„ë¡œ êµ¬í•œ $n$ë²ˆì§¸ í•­ ($a_1 \\cdot r^{n-1}$) = **{calculated_an:.6f}**")
            
            if abs(calculated_an - an) < 1e-6: # ë¶€ë™ì†Œìˆ˜ì  ì˜¤ì°¨ ê³ ë ¤
                st.info("ì…ë ¥ëœ $n$ë²ˆì§¸ í•­ê³¼ ê³„ì‚°ëœ $n$ë²ˆì§¸ í•­ì´ ì¼ì¹˜í•©ë‹ˆë‹¤. (ë¯¸ì„¸í•œ ì˜¤ì°¨ ë²”ìœ„ ë‚´)")
            else:
                st.warning(f"ì…ë ¥ëœ $n$ë²ˆì§¸ í•­ ({an})ê³¼ ê³„ì‚°ëœ $n$ë²ˆì§¸ í•­ ({calculated_an:.6f}) ì‚¬ì´ì— ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤. (ë¶€ë™ì†Œìˆ˜ì  ì •ë°€ë„ ë¬¸ì œì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)")

st.markdown("---")
st.markdown("ë“±ë¹„ìˆ˜ì—´ ì¼ë°˜í•­: $a_n = a_1 \\cdot r^{n-1}$")
st.markdown("ê³µë¹„ ($r$) ê³„ì‚° ê³µì‹: $r = (a_n / a_1)^{1/(n-1)}$")
